<!-- Dashboard Layout -->
<div class="dashboard-bg">
  <!-- Top Navigation Bar -->
  <div class="top-nav">
    <img src="assets/logoName.png" alt="Sway Logo" class="dashboard-logo">
    <div class="nav-buttons">
      <button class="nav-btn help-btn" (click)="showInfoModal = true">
        <i class="fas fa-info-circle"></i> Help
      </button>
      <div class="join-code-display" *ngIf="team">
        Join Code: <span class="join-code">{{ team.joinCode }}</span>
      </div>
      <button *ngIf="isCaptain" class="nav-btn edit-team-btn" (click)="showRosterModal = true">
        <i class="fas fa-users"></i> Edit Team
      </button>
    </div>
  </div>

  <!-- Sets Section -->
  <div class="sets-section">
    <div class="sets-header">
      <h1 class="sets-title">Your Sets</h1>
      <button *ngIf="isCaptain" class="add-set-btn" (click)="openSetModal()">
        Create New Set
      </button>
    </div>
    
    <div class="sets-container">
      <ng-container *ngIf="sets.length > 0; else noSets">
        <div class="set-row" *ngFor="let set of sets; let setIndex = index">
          <div class="set-content">
            <div class="set-header">
              <div class="set-info">
                <div class="set-icon" (click)="toggleSetVisibility(set._id)" [title]="getSetVisibilityStatus(set._id) ? 'Click to make all segments private' : 'Click to make all segments public'">
                  <i class="fas" [class.fa-eye]="getSetVisibilityStatus(set._id)" [class.fa-eye-slash]="!getSetVisibilityStatus(set._id)"></i>
                </div>
                <h3 class="set-name">{{ set.name }}</h3>
                <div class="set-stats">
                  <span class="segment-count">{{ getSegmentsForSet(set._id).length }} segments</span>
                  <span class="total-duration">{{ getTotalDuration(set._id) }}s total</span>
                </div>
              </div>
              <div class="set-actions">
                <button class="add-segment-btn" *ngIf="isCaptain" (click)="addSegmentToSet(set._id)">
                  <i class="fas fa-plus"></i> Add Segment
                </button>
                <button class="set-menu-btn" *ngIf="isCaptain" (click)="toggleSetMenu(set._id)">
                  <i class="fas fa-ellipsis-v"></i>
                </button>
                <div class="set-menu-dropdown" *ngIf="activeSetMenu === set._id" (clickOutside)="activeSetMenu = null">
                  <button (click)="editSet(set._id)">
                    <i class="fas fa-edit"></i> Edit Set
                  </button>
                  <button (click)="deleteSet(set._id)" class="delete-option">
                    <i class="fas fa-trash"></i> Delete Set
                  </button>
                </div>
              </div>
            </div>
            
            <div class="segments-in-set">
              <ng-container *ngIf="getSegmentsForSet(set._id).length > 0; else noSegmentsInSet">
                <div class="segment-card-enhanced"
                     *ngFor="let segment of getSegmentsForSet(set._id); let segIndex = index"
                     [attr.data-segment-id]="segment._id">
                  <div class="segment-grid-bg"></div>
                  <div class="segment-number">{{ segIndex + 1 }}</div>
                  <div class="segment-main-content">
                    <h4 class="segment-title">{{ segment.name }}</h4>
                    <div class="segment-style-pills" *ngIf="segment.stylesInSegment?.length">
                      <span class="style-pill" *ngFor="let styleName of segment.stylesInSegment"
                            [ngStyle]="{ 'background-color': getStyleColor(styleName) }">
                        {{ styleName }}
                      </span>
                    </div>
                  </div>
                  <div class="segment-duration">{{ getSegmentDuration(segment) }}s</div>
                  <div class="segment-actions">
                    <button class="action-btn preview-btn" (click)="previewSegment(segment._id)">
                      <i class="fas fa-play"></i> Preview
                    </button>
                    <button class="action-btn edit-btn" (click)="goToSegment(segment._id)">
                      <i class="fas fa-edit"></i> Edit
                    </button>
                  </div>
                </div>
                
                <!-- Arrow to next set -->
                <div class="next-set-arrow" *ngIf="setIndex < sets.length - 1">
                  <i class="fas fa-arrow-right"></i>
                </div>
              </ng-container>
              
              <ng-template #noSegmentsInSet>
                <div class="no-segments-in-set">
                  <span>No segments in this set</span>
                  
                </div>
              </ng-template>
            </div>
          </div>
        </div>
      </ng-container>
      
      <ng-template #noSets>
        <div class="no-sets">
          <span>No sets created yet</span>
          <button *ngIf="isCaptain" class="create-first-set-btn" (click)="openSetModal()">
            <i class="fas fa-plus"></i> Create Your First Set
          </button>
        </div>
      </ng-template>
    </div>
  </div>

  <!-- Roster Modal -->
  <div class="roster-modal-overlay" *ngIf="showRosterModal">
    <div class="roster-modal-popup">
      <app-dashboard-roster (close)="showRosterModal = false"></app-dashboard-roster>
    </div>
  </div>

  <!-- Set Creation Modal -->
  <div class="modal-backdrop" *ngIf="showSetModal">
    <div class="modal frosted-glass-modal">
      <h2>{{ editingSet ? 'Edit Set' : 'Create New Set' }}</h2>
      <form (ngSubmit)="submitSetModal()">
        <label>
          Set Name
          <input type="text" [(ngModel)]="newSetName" name="name" required />
        </label>
        <div class="modal-actions">
          <button type="submit" class="submit-btn">{{ editingSet ? 'Update' : 'Create' }}</button>
          <button type="button" (click)="closeSetModal()" class="cancel-btn">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Segment Creation Modal -->
  <div class="modal-backdrop" *ngIf="showSegmentModal">
    <div class="modal modern-segment-modal">
      <div class="modal-header">
        <div class="modal-title">
          <i class="fas fa-music"></i>
          <h2>Create New Segment</h2>
        </div>
        <button type="button" class="modal-close-btn" (click)="closeSegmentModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <form (ngSubmit)="submitSegmentModal()" class="segment-form">
        <!-- Main Content Row -->
        <div class="form-main-row">
          <!-- Left Side - Name and Settings -->
          <div class="form-left">
            <!-- Segment Name -->
            <div class="form-group">
              <label class="form-label">Segment Name <span class="required">*</span></label>
              <input 
                type="text" 
                [(ngModel)]="newSegmentName" 
                name="name" 
                required 
                class="form-input"
                placeholder="e.g., Opening Formation, Finale"
              />
            </div>

            <!-- Public/Private Toggle -->
            <div class="form-group">
              <div class="visibility-toggle">
                <div class="toggle-icon">
                  <i class="fas" [class.fa-eye]="newSegmentIsPublic" [class.fa-eye-slash]="!newSegmentIsPublic"></i>
                </div>
                <div class="toggle-content">
                  <h3>{{ newSegmentIsPublic ? 'Public Segment' : 'Private Segment' }}</h3>
                  <p>{{ newSegmentIsPublic ? 'Visible to the full team' : 'Only visible to captains' }}</p>
                </div>
                <div class="toggle-switch" (click)="newSegmentIsPublic = !newSegmentIsPublic">
                  <div class="toggle-track" [class.active]="newSegmentIsPublic">
                    <div class="toggle-thumb"></div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Dimensions -->
            <div class="form-group dimensions-section">
              <div class="dimensions-row">
                <div class="dimension-field">
                  <label class="form-label">Width</label>
                  <input 
                    type="number" 
                    [(ngModel)]="newSegmentWidth" 
                    name="width" 
                    min="1" 
                    required
                    class="form-input-small"
                  />
                </div>
                <div class="dimension-field">
                  <label class="form-label">Height</label>
                  <input 
                    type="number" 
                    [(ngModel)]="newSegmentDepth" 
                    name="depth" 
                    min="1" 
                    required
                    class="form-input-small"
                  />
                </div>
                <div class="dimension-field">
                  <label class="form-label">Divisions</label>
                  <input 
                    type="number" 
                    [(ngModel)]="newSegmentDivisions" 
                    name="divisions" 
                    min="1" 
                    required
                    class="form-input-small"
                  />
                </div>
              </div>
            </div>
          </div>

          <!-- Right Side - Dance Styles -->
          <div class="form-right">
            <div class="form-group">
              <div class="styles-header">
                <label class="form-label">Dance Style <span class="required">*</span></label>
                                 <p class="styles-subheader">Add to view dancers skill level on chosen styles</p>
              </div>
              
              <div class="styles-grid-modern">
                <div *ngFor="let style of teamStyles" 
                     class="style-badge"
                     [class.selected]="isStyleSelected(style)"
                     (click)="toggleStyle(style, !isStyleSelected(style))">
                  <div class="style-circle" [style.background]="style.color"></div>
                  <span class="style-name">{{ style.name }}</span>
                </div>
              </div>

              <!-- Add New Style Button -->
              <div class="add-style-section" *ngIf="isCaptain">
                <div class="add-new-style-btn" 
                     *ngIf="!showAddStyleInput"
                     (click)="showAddStyleInput = true">
                  <i class="fas fa-plus"></i>
                  <span>Add New Style</span>
                </div>

                <!-- Add Style Input -->
                <div *ngIf="showAddStyleInput" class="add-style-input">
                  <input 
                    type="text" 
                    [(ngModel)]="newStyleName" 
                    name="newStyleName" 
                    placeholder="Style name"
                    class="style-input"
                    (keydown.enter)="addNewStyle()"
                    autofocus
                  />
                  <button type="button" (click)="addNewStyle()" class="add-style-confirm">
                    <i class="fas fa-check"></i>
                  </button>
                  <button type="button" (click)="cancelAddStyle()" class="add-style-cancel">
                    <i class="fas fa-times"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Bottom Row: Validation Message and Action Buttons -->
        <div class="modal-bottom-row">
          <div class="validation-message" *ngIf="!newSegmentName || newSegmentStyles.length === 0">
            Please fill in segment name and select a style
          </div>
          <div class="modal-actions-modern">
            <button type="button" (click)="closeSegmentModal()" class="btn-cancel">Cancel</button>
            <button type="submit" class="btn-create" [disabled]="!newSegmentName || newSegmentStyles.length === 0">
              Create Segment
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- Info Modal -->
  <div class="info-modal-overlay" *ngIf="showInfoModal" (click)="showInfoModal = false">
    <div class="info-modal-popup" (click)="$event.stopPropagation()">
      <div class="info-modal-header">
        <h3>Getting Started with Sway</h3>
        <button class="close-btn" (click)="showInfoModal = false">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="info-modal-content">
        <div class="info-item">
          <i class="fas fa-plus-circle"></i>
          <div class="info-text">
            <strong>Create sets and add segments</strong>
            <p>Organize your choreography into sets and add segments to build formations.</p>
          </div>
        </div>
        <div class="info-item">
          <i class="fas fa-user-plus"></i>
          <div class="info-text">
            <strong>Add performers to segments</strong>
            <p>Add team members so they can see their formations at practice.</p>
          </div>
        </div>
        <div class="info-item">
          <i class="fas fa-palette"></i>
          <div class="info-text">
            <strong>Add styles</strong>
            <p>Connect segments with styles to view skill level when building formations.</p>
          </div>
        </div>
        <div class="info-item">
          <i class="fas fa-arrows-alt"></i>
          <div class="info-text">
            <strong>Drag and move formations</strong>
            <p>Rearrange formations in your set order to get feedback on where users should be positioned.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div> 