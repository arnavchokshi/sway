<div class="pricing-bg">
  <!-- Payment Success/Failure Banner -->
  <div *ngIf="paymentBannerVisible && paymentSuccess !== null" class="payment-banner" [class.success]="paymentSuccess" [class.failure]="!paymentSuccess">
    <span *ngIf="paymentSuccess">üéâ Payment successful! Your Pro membership is now active.</span>
    <span *ngIf="paymentSuccess === false">‚ùå Payment canceled or failed. Please try again.</span>
    <button class="close-banner" (click)="dismissPaymentBanner()">&times;</button>
  </div>

  <div class="back-btn-row">
    <button class="back-btn" (click)="goToDashboard()">
      ‚Üê Back to Dashboard
    </button>
  </div>

  <!-- Floating Current Plan Badge -->
  <div class="current-plan-badge frosted-glass" *ngIf="!loading && membershipStatus">
    <span>Current Plan:</span>
    <span class="plan-type" [class.pro]="membershipStatus.membershipType === 'pro'" [class.free]="membershipStatus.membershipType === 'free'">
      {{ getMembershipBadgeText() }}
    </span>
  </div>

  <!-- Current Membership Status -->
  <div class="membership-status" *ngIf="!loading && membershipStatus">
    <div class="status-card frosted-glass">
      
      
      <div class="status-details">
        <!-- Pro Membership Details -->
        <div class="pro-details" *ngIf="membershipStatus.membershipType === 'pro'">
          <p *ngIf="membershipStatus.expiresAt">
            <strong>Expires:</strong> {{ membershipStatus.expiresAt | date:'mediumDate' }}
            <span *ngIf="membershipStatus.daysUntilExpiry">
              ({{ membershipStatus.daysUntilExpiry }} days remaining)
            </span>
          </p>
          
          <!-- Referral Code Display -->
          <div class="referral-code-display" *ngIf="membershipStatus.referralCode">
            <h3>Your Referral Code</h3>
            <p>Share this code with other teams! When they use it, <strong>you</strong> get 1 month of Pro for free!</p>
            <p class="referral-requirements">
              <strong>Requirements for them:</strong> Their team must have at least 10 registered users (with emails). 
              Each referral code can only be used once.
            </p>
            <div class="code-display">
              <span class="code">{{ membershipStatus.referralCode }}</span>
              <button class="copy-btn" (click)="navigator.clipboard.writeText(membershipStatus.referralCode!)">
                Copy
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="pricing-header">
    <h1 class="pricing-title">
      <span class="white-text">Pricing</span> <span class="yellow-text"> Plans</span>
    </h1>
    <div class="pricing-subtitle">
      Consider upgrading to a paid plan to unlock all features and scale your team to the next level
    </div>
  </div>

  <div class="plans-row modern-layout">
    <!-- Free Plan -->
    <div class="plan-card frosted-glass" [class.current-plan]="membershipStatus?.membershipType === 'free'">
      <div class="plan-card-inner">
        <div class="plan-title">Free</div>
        <div class="plan-desc">Everything to start</div>
        <div class="plan-price-row">
          <span class="plan-price">$0</span>
          <span class="plan-per">/month</span>
        </div>
        <ul class="plan-features">
          <li><span class="check yellow">‚úî</span> 3 captain limit</li>
          <li><span class="check yellow">‚úî</span> Up to 30 Team Members</li>
          <li><span class="check yellow">‚úî</span> Up to 10 Segments</li>
          <li><span class="check yellow">‚úî</span> Up to 3 Sets</li>
          <li><span class="cross">‚úñ</span> AI Features</li>
          <li><span class="cross">‚úñ</span> Backdrop Render</li>
        </ul>
        <button class="try-btn outline-btn" [disabled]="membershipStatus?.membershipType === 'free'">
          <span class="play-icon">‚ñ∂</span> 
          {{ membershipStatus?.membershipType === 'free' ? 'CURRENT PLAN' : 'SIGN UP FREE' }}
        </button>
      </div>
    </div>

    <!-- Pro Plan -->
    <div class="plan-card pro frosted-glass" [class.current-plan]="membershipStatus?.membershipType === 'pro'">
      <div class="most-popular-badge">Premium</div>
      <div class="plan-card-inner">
        <div class="plan-title">Pro</div>
        <div class="plan-desc">Everything to scale</div>
        <div class="plan-price-row">
          <span class="plan-price highlight">$4.99</span>
          <span class="plan-per">/month</span>
        </div>
        <ul class="plan-features">
          <li><span class="check yellow">‚úî</span> Unlimited captains</li>
          <li><span class="check yellow">‚úî</span> Unlimited Team Members</li>
          <li><span class="check yellow">‚úî</span> Unlimited Segments</li>
          <li><span class="check yellow">‚úî</span> Unlimited Sets</li>
          <li><span class="check yellow">‚úî</span> All AI-powered choreography tools</li>
          <li><span class="check yellow">‚úî</span> Backdrop Render Included</li>
        </ul>
        <button class="try-btn yellow-btn" (click)="goToPayment()" 
                [disabled]="membershipStatus?.membershipType === 'pro'">
          <span class="play-icon">‚ñ∂</span> 
          {{ membershipStatus?.membershipType === 'pro' ? 'CURRENT PLAN' : 'SIGN UP PRO' }}
        </button>
      </div>
    </div>
  </div>

  <!-- Referral Code Section just below the plans -->
  <div class="referral-bottom-card frosted-glass" *ngIf="!loading && membershipStatus && canApplyReferral()">
    <div class="referral-header">
      <span class="gift-icon" aria-label="present icon">
        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#ffd600" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: middle;">
          <rect x="3" y="8.5" width="18" height="12" rx="2.5"/>
          <path d="M3 12h18"/>
          <path d="M12 8.5v12"/>
          <path d="M7.5 8.5a2.5 2.5 0 1 1 5 0 2.5 2.5 0 1 1 5 0"/>
        </svg>
      </span>
      <span class="referral-title">Have a <span class="highlight">Referral Code</span>?</span>
    </div>
    <div class="referral-desc">
      Enter another team's referral code to give <span class="highlight">them</span> 1 month of Pro for free!
    </div>
    <div class="referral-req-card">
      <span class="req-title">Requirements:</span>
      <span class="req-desc">
        Your team must have at least 10 registered users (with emails) to use a referral code. Each team can only use one referral code ever.
      </span>
    </div>
    <div class="referral-input-row">
      <input type="text" [(ngModel)]="referralCode" placeholder="Enter referral code" [disabled]="applyingReferral">
      <button (click)="applyReferralCode()" [disabled]="applyingReferral || !referralCode.trim()">
        {{ applyingReferral ? 'Applying...' : 'Apply Code' }}
      </button>
    </div>
    <div class="referral-message" *ngIf="referralMessage" [class.success]="referralSuccess" [class.error]="!referralSuccess">
      {{ referralMessage }}
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-state" *ngIf="loading">
    <div class="spinner"></div>
    <p>Loading membership status...</p>
  </div>
</div> 